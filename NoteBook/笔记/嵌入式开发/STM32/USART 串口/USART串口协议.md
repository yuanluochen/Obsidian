# 串口协议

通讯目的：将一个设备数据传到另一个设备，扩展硬件设备
通讯协议：制定通信规则，通信双方按照协议规则进行数据收发。

USART：引脚TX、RX，为全双工[^1]，时钟特性为异步通信[^2]，电平特性为单端[^3]，设备特性为点对点。

## 基本配置

### 硬件电路

由于USART的TX、RX都为单端信号，所以需要共地即，GND接同一条线，并且两个设备都需要进行供电。TX和RX要交叉连接。若只需单向数据传输，那就可以只接一根数据线，此时该USART就变为单工的模式。当两设备电平标准[^4]不同时(由于两设备需要连接通信线，若电平标准不统一，则会出现问题）需要在两个设备之间加一个电平转换芯片。

### 串口参数及时序

- 波特率：串口通信速率，由于串口通信为异步通信，所以双方要约定一个相同的接收速度的速率，这个速率就是波特率[^5]。
- 起始位：标志一个数据帧的开始，固定为低电平，产生下降沿，表示数据传输的开始。
- 数据位：表示数据帧的有效载荷。1为高电平，0为低电平，低位先行[^6]。
- 校验位：用于数据验证，根据数据计算得来的，stm32采用奇偶校验，其串口传输数据模式有三种，无校验、奇校验、偶校验。当采用奇校验时，发送的数据位与奇偶校验位应有奇数个1，发送方会判断发送数据是否有奇数个1，若无奇数个1，则奇偶检验位则会置1，使发送的的数据1为奇数个，接收方会判断，数据是否有奇数个1，若不为奇数个，则抛弃数据。
- 停止位：固定为1，把引脚恢复为高电平，方便产生下一次下降沿，若未有数据此时引脚也为高电平，代表空闲状态。

已发送数据0x55为例，先起始位置零表示传输数据开始，然后数据发送0x55原为0101 0101在传输数据低位先行，依次发送1010 1010，若为奇校验，则奇偶校验位置1保证有奇数个1，然后上升沿，电平为1，停止位，发送数据结束。

[^1]: 全双工为数据可以双向通信，一般全双工的通信都有两根通信线，一根负责发送，一根负责接收，其发送线路和接收线路互补影响。除全双工外，还有半双工，单工，像can、I2C仅有一根通信线（两根线组成一根通信线），这种被称之为半双工，还有一种单工，该种通信数据仅可从一个设备发送到另一个设备，不可反过来发送。

[^2]:异步通信：像I2C,SPI多设备之间有共同的时钟线连接数据的发送通过共同的时钟线，这种情况下，称之为同步通信。而异步通信则不同于以上，异步通信的设备没有共同的时钟线连接，之间数据的传输需要约定一个共同的频率(例如串口通信设备之间需要配置相同的波特率)，还需要配置相同的一些帧头帧尾来进行采样位置的对其。

[^3]:单端：该外设引脚的高低电平都是对GND的电压差，所以该通信设备的引脚要共地，这要才能保证电平信号的统一，该类型的外设的引脚不接GND无法进行通信。电平特性除单端外，还有差分，该类型的外设通过两个差分引脚的电压差来传输信号。该类型的外设引脚可不接GND就可通信。使用差分信号可极大的提高抗干扰特性。

[^4]:电平标志：串口常用的电平标志有如下三种，TTL电平：+3.3V或5V表示1，0V表示0。RS232电平：-3 ~ -15V表示1，+3 ~ +15V表示0。RS485电平：两线压差 +2 ~ +6表示1， -2 ~ -6表示0，(差分信号）。stm32为低压小型设备，若想使用RS485电平：那就需要外接电平转换芯片。

[^5]:波特率：其单位为码元/s，或者直接叫波特(Baud），除此之外还有一个速率表示为比特率，其单位为Bit/s，或者直接叫bps，在二进制调制的情况下，一个码元就是一个Bit，此时波特率就等于比特率。在单片机中多数都是二进制调制即，高电平表示1，低电平表示0，1位就是一个Bit，若为多进制调制，此时波特率不等于比特率。

[^6]:低位先行：例如要发送的数据为0X0F，转换为二进制为0000 1111，此数据发送时首先发送低位在发送高位，发送后的数据为 1111 0000。
