# can通信

## can基础

### 硬件

#### 硬件连接

cpu连接can控制器，can控制器连接收发器，cpu 通过can控制器，将can信号经过收发器，发送到设备

#### 电平信号

电平分显性和隐性

#### CAN外设结构

- 邮箱(发送，接收)  
3个发送邮箱，2个接收邮箱
- 筛选器

### 软件

#### CAN帧的种类

| 名称               | 作用                                                         |
| ------------------ | ------------------------------------------------------------ |
| [数据帧](#^e2420d) | 用于发送单元向接收单元发送数据的帧                           |
| 遥控帧             | 用于接收单元向具有相同ID发送请求数据的帧                     |
| 错误帧             | 用于当检测出错误时向其他单元通知错误的帧                     |
| 过载帧             | 当一个节点正忙于处理的信息，可以通知其他节点缓慢接收报文的帧 |
| 帧间隔             | 用于将数据帧及遥控帧与前面的帧分离开的帧                     |

1. 数据帧 ^e2420d
   - 仲裁段  
相当于文件的标题，数据的id，在标准格式下，其为11位，在拓展格式下，其为 11 + 18 位ID。
   - 控制段  
确定要发送的字节数，最多可以发8位
   - 数据段  
发送的内容

#### 筛选器

1. 选择关心的几位
2. 列表模式

#### 波特率

波特率计算公式

$$CAN波特率 = APB总线频率/分频系数/(TBS1 + TBS2 + SJY)$$

#### CAN的形象讲解


